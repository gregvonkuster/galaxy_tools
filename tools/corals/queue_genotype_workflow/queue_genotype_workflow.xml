<tool id="queue_genotype_workflow" name="Queue genotype workflow" version="1.0.0">
    <description></description>
    <command detect_errors="exit_code"><![CDATA[
#set history_id = $__app__.security.encode_id($affy_metadata.history.id)
#set history_name = $affy_metadata.history.name
python $__tool_directory__/queue_genotype_workflow.py
--affy_metadata '$affy_metadata'
--annot '$annot'
--api_key $get_user_api_key
--calls '$calls'
--confidences '$confidences'
--config_file $__tool_directory__/qgw_config.ini
#if str($reference_genome_source_cond.reference_genome_source) == 'history':
    --dbkey '$reference_genome_source_cond.history_item.metadata.dbkey'
    --reference_genome '$reference_genome_source_cond.history_item'
#else:
    --reference_genome '$reference_genome_source_cond.locally_cached_item.fields.path'
    --dbkey '$reference_genome_source_cond.locally_cached_item.fields.value'
#end if
--history_id $history_id
--history_name '$history_name'
--report '$report'
--snp-posteriors '$snp_posteriors'
--summary '$summary'
--user_email '$__user_email__'
--user_id "$__app__.security.encode_id('__user_id__')"
--output '$output'
    ]]></command>
    <configfiles>
        <configfile name="get_user_api_key"><![CDATA[#from galaxy.managers import api_keys#${api_keys.ApiKeyManager( $__app__ ).get_or_create_api_key($__user__)} ]]></configfile>
    </configfiles>
    <inputs>
        <param name="affy_metadata" type="data" format="tabular" label="Affymetrix 96 well plate metadata file">
            <validator type="expression" message="96 well plate data must have 28 columns and no more than 96 lines of data"><![CDATA[value is not None and value.metadata.columns==28 and value.metadata.data_lines<=96]]></validator>
        </param>
        <param name="annot" type="data" format="csv" label="Probeset annotation file" />
        <param name="summary" type="data" format="txt" label="Apt-probeset genotype summary file" />
        <param name="snp_posteriors" type="data" format="txt" label="Apt-probeset genotype snp-posteriors file" />
        <param name="report" type="data" format="txt" label="Apt-probeset genotype report file" />
        <param name="confidences" type="data" format="txt" label="Apt-probeset genotype confidences file" />
        <param name="calls" type="data" format="txt" label="Apt-probeset genotype calls file" />
        <conditional name="reference_genome_source_cond">
            <param name="reference_genome_source" type="select" label="Choose the source for the reference genome">
                <option value="history" selected="true">Use a reference genome from my history</option>
                <option value="cached">Use a locally cached genome index</option>
            </param>
            <when value="history">
                <param name="history_item" type="data" format="fasta" label="Select reference genome" />
            </when>
            <when value="cached">
                <param name="locally_cached_item" type="select" format="fasta" label="Fasta reference sequence">
                    <options from_data_table="all_fasta">
                        <column name="name" index="2"/>
                        <column name="value" index="0"/>
                        <column name="path" index="3"/>
                        <filter type="sort_by" column="1"/>
                        <validator type="no_options" message="No cached Fasta genome references are available for the build associated with the selected probeset annotation file." />
                    </options>
                </param>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output" format="txt" />
    </outputs>
    <tests>
    </tests>
    <help>
**What it does**
    </help>
    <citations>
    </citations>
</tool>
