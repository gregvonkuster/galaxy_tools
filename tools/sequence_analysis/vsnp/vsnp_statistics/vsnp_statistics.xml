<tool id="vsnp_statistics" name="vSNP: statistics" version="1.0.0">
    <description></description>
    <requirements>
        <requirement type="package" version="0.5.1">humanize</requirement>
        <requirement type="package" version="1.16.5">numpy</requirement>
        <requirement type="package" version="0.24.2">pandas</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
#import re
#set read1_identifier = re.sub('[^\s\w\-]', '_', str($read1.element_identifier))
#if str($read_type_cond.read_type) == "single":
    ln -s '${read1}' '${read1_identifier}' &&
#else:
    #set read2_identifier = re.sub('[^\s\w\-]', '_', str($read2.element_identifier))
    ln -s '${read1}' '${read1_identifier}' &&
    ln -s '${read2}' '${read2_identifier}' &&
#end if
python '$__tool_directory__/vsnp_statistics.py'
#if str($read_type_cond.read_type) == "single":
    --read1 '${read1_identifier}'
    #if $read1.is_of_type('fastqsanger.gz'):
        --gzipped 'true'
    #end if
#else:
    --read1 '${read1_identifier}'
    --read2 '${read2_identifier}'
    #if $read1.is_of_type('fastqsanger.gz') and $read2.is_of_type('fastqsanger.gz'):
        --gzipped 'true'
    #end if
#end if
#if str($genome_cond.genome_source) == "cached"
    --genome '$genome_cond.reference.fields.name'
#else:
    --genome '$genome_cond.reference.metadata.dbkey'
#end if
--samtools_idxstats '$samtools_idxstats'
--vsnp_azc '$vsnp_azc'
--output '$output'
]]></command>
    <inputs>
        <conditional name="read_type_cond">
            <param name="read_type" type="select" label="Choose the read type">
                <option value="single" selected="true">Single</option>
                <option value="paired">Paired</option>
            </param>
            <when value="single">
                <param name="read1" type="data" format="fastqsanger.gz,fastqsanger" label="Read1 fastq file"/>
            </when>
            <when value="paired">
                <param name="read1" type="data" format="fastqsanger.gz,fastqsanger" label="Read1 fastq file"/>
                <param name="read2" type="data" format="fastqsanger.gz,fastqsanger" label="Read2 fastq file"/>
            </when>
        </conditional>
        <param name="samtools_idxstats" type="data" format="tabular" label="Samtools idxstats output"/>
        <param name="vsnp_azc" type="data" format="tabular" label="vSNP add zero coverage (metrics) output"/>
        <conditional name="genome_cond">
            <param name="genome_source" type="select" label="Choose the source for the genome">
                <option value="cached">locally cached</option>
                <option value="history">from history</option>
            </param>
            <when value="cached">
                <param name="reference" type="select" label="Using reference genome">
            <options from_data_table="fasta_indexes"/>
                    <filter type="data_meta" column="dbkey" key="dbkey" ref="vsnp_azc"/>
                    <validator type="no_options" message="A built-in reference genome is not available for the build associated with the selected BAM input file"/>
                </param>
            </when>
            <when value="history">
                <param name="reference" type="data" format="fasta" label="Using reference genome">
                    <filter type="data_meta" column="dbkey" key="dbkey" ref="vsnp_azc"/>
                    <validator type="no_options" message="The current history does not include a fasta dataset with the build associated with the selected BAM input file"/>
                </param>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output" format="tabular"  label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test>
        </test>
    </tests>
    <help>
**What it does**

Calculates vSNP statistics for fastqsanger VCF files.
    </help>
    <citations>
        <citation>
        </citation>
    </citations>
</tool>

