<tool id="vsnp_add_zero_coverage" name="vSNP: add zero coverage" version="1.0.0">
    <description></description>
    <requirements>
        <requirement type="package" version="1.76">biopython</requirement>
        <requirement type="package" version="1.16.5">numpy</requirement>
        <requirement type="package" version="0.24.2">pandas</requirement>
        <requirement type="package" version="0.15.4">pysam</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
#import re
#set bam_input_identifier = re.sub('[^\s\w\-]', '_', str($bam_input.element_identifier))
#set vcf_input_identifier = re.sub('[^\s\w\-]', '_', str($vcf_input.element_identifier))
ln -s '${bam_input}' '${bam_input_identifier}' &&
ln -s '${vcf_input}' '${vcf_input_identifier}' &&
python '$__tool_directory__/vsnp_add_zero_coverage.py'
--bam_input '${bam_input_identifier}'
--vcf_input '${vcf_input_identifier}'
--output_metrics '$output_metrics'
--output_vcf '$output_vcf'
#if str($reference_cond.reference_source) == "cached"
    --reference '$reference_cond.reference.fields.path'
#else:
    --reference '$reference_cond.reference'
#end if
]]></command>
    <inputs>
        <param name="bam_input" type="data" format="bam" label="BAM file">
            <validator type="unspecified_build"/>
        </param>
        <param name="vcf_input" type="data" format="vcf" label="VCF file">
            <validator type="unspecified_build"/>
        </param>
        <conditional name="reference_cond">
            <param name="reference_source" type="select" label="Choose the source for the reference genome">
                <option value="cached" selected="true">locally cached</option>
                <option value="history">from history</option>
            </param>
            <when value="cached">
                <param name="reference" type="select" label="Using reference genome">
                    <options from_data_table="fasta_indexes">
                        <filter type="data_meta" ref="bam_input" key="dbkey" column="1"/>
                    </options>
                    <validator type="no_options" message="A built-in reference genome is not available for the build associated with the selected BAM file"/>
                </param>
            </when>
            <when value="history">
                <param name="reference" type="data" format="fasta" label="Using reference genome">
                    <validator type="no_options" message="The current history does not include a fasta dataset"/>
                </param>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output_vcf" format="vcf"  label="${tool.name} (filtered vcf) on ${on_string}"/>
        <data name="output_metrics" format="tabular"  label="${tool.name} (metrics) on ${on_string}"/>
    </outputs>
    <tests>
        <test>
            <param name="bam_input" value="bam_input.bam" ftype="bam" dbkey="89"/>
            <param name="vcf_input" value="vcf_input.vcf" ftype="vcf" dbkey="89"/>
            <param name="reference_source" value="history"/>
            <param name="reference" value="NC_002945v4.fasta" ftype="fasta"/>
            <param name="output_vcf" value="output_vcf.vcf" ftype="vcf" compare="contains"/>
            <output name="output_metrics" file="output_metrics.tabular" ftype="tabular" compare="contains"/>
        </test>
    </tests>
    <help>
**What it does**

Adds zero coverage to a BAM dataset.
    </help>
    <citations>
        <citation type="doi">
        </citation>
    </citations>
</tool>

